<!DOCTYPE html>
<html>
<head>
<style>
body {
    background-color: #fff;
    color: #555;
    font: 400 12px Arial, Helvetica, sans-serif;
    position: relative;
}
.box {
    margin: 4.5em 7.5em;
    padding: 3em;
    background-color: rgba(20,53,80,0.038);
    border: 1px solid rgba(20,53,80,0.05);
}

canvas {
	border:1px solid #d3d3d3;
}
</style>
</head>
<body>

<div class="box">                
	<h3>Plot Recorded Homey Signal</h3>
	Use this tool to vizualize the signal timings generated by Homey.
	<p>
	Paste the raw timings of your recorded signal in the textarea below and press 'start plotting'. 
	</p>
		
	<p style="word-wrap: break-word;">Example raw timings: 294,966,954,322,956,308,322,952,332,944,320,954,328,946,958,318,964,302,968,312,968,298,968,312,326,942,972,298,972,310,332,948,328,944,964,308,968,310,326,944,962,310,332,942,966,310,330,944,306,9716</p>
	
	<p>
		<input type="button" id="plot-button" value="Start plotting" title="plot" style="margin: 5px 0px;">
	</p>
	<textarea id="record-data" placeholder="Signal recording data" rows="5" style="width: 100%;"></textarea>
	<div>
  <input type="range" id="scale" name="scale" min="1" max="10" value="1">
  <label for="volume">Scale</label>
</div>
</div>
<canvas id="signal-canvas" width="3000" height="150" style="display: none;">
Your browser does not support the HTML5 canvas tag.</canvas>


</div>

<script>
var recordData = document.getElementById('plot-button');

recordData.addEventListener('click', plot_signal, false);
function plot_signal() {
	var element = document.getElementById('record-data');
	var timings = element.value.replace(/[\[\]']+/g,'').split(",").map(Number);
	if (timings.length <= 1) return;
	var yPos1 = 30;
	var yPos0 = 100;
	var xPos = 100;
	
	var c = document.getElementById("signal-canvas");
	show(c);
	var ctx = c.getContext("2d");
	ctx.clearRect(0, 0, c.width, c.height); //clear canvas
	ctx.strokeStyle = 'rgba(65, 119, 244, 1)';
	ctx.lineWidth = .5;
	ctx.moveTo(0,yPos0);
	ctx.lineTo(xPos,yPos0);
	ctx.stroke();
	ctx.moveTo(xPos,yPos0);
	
	var denominator = 25 / document.getElementById('scale').value;
	
	for(var x = 0; xPos < c.width && x < timings.length;x++) {
		var scale = timings[x]/denominator;
		if (x % 2 == 0) {
			ctx.lineTo(xPos,yPos1);
			ctx.stroke();
			ctx.moveTo(xPos,yPos1);
			ctx.lineTo(xPos+=scale,yPos1);
			ctx.stroke();
			ctx.moveTo(xPos,yPos1);
			ctx.lineTo(xPos,yPos0);
			ctx.stroke();
		}
		else {
			ctx.lineTo(xPos,yPos0);
			ctx.stroke();
			ctx.moveTo(xPos,yPos0);
			ctx.lineTo(xPos+=scale,yPos0);
			ctx.stroke();
			ctx.moveTo(xPos,yPos0);
			ctx.lineTo(xPos,yPos0);
			ctx.stroke();
		}
	}

	var ctx2 = c.getContext("2d");
	
	font = 8.5;
	ctx2.font = font + 'px Arial, Verdana, sans-serif';
	ctx2.strokeStyle = 'rgba(0, 0, 0, 0.15)';
	xPos = 100;
	drawLine(xPos);
	for(var x = 0;  xPos < c.width && x < timings.length;x++) {
		var scale = timings[x]/denominator;
		drawLabel(timings[x], xPos + (scale/2));
		drawLine(xPos+=scale);
	}

	function drawLine(pos) {
	  ctx2.beginPath();
	  ctx2.lineWidth = 1;
	  ctx2.moveTo(pos, 5);
	  ctx2.lineTo(pos, yPos0 + 35);
	  ctx2.stroke();
	}

	function drawLabel(label, pos) {
		ctx2.save();
		ctx2.translate(pos+5,yPos0 + 30);
		ctx2.rotate(-0.5*Math.PI);
		ctx2.fillText(label, 0, 0);
		ctx2.restore();
	}
}

var show = function (e) {
	e.style.display = 'block';
};

var hide = function (e) {
	e.style.display = 'none';
};
</script>

</body>
</html>
